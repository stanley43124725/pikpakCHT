import{_ as S,a as G}from"./favicon.61477d4b.js";import{d as P,r as s,l as W,u as Y,a7 as K,a as z,b as U,s as D,E as c,e as a,f as t,ao as V,w as o,ad as j,am as k,R as C,Q as x,y as h,A as R,ap as L,F as w,I as N,aW as q,aV as J,k as Q}from"./vendor.c9705c7c.js";import{i as f}from"./index.7613b16d.js";const H={class:"login-page"},X=c("div",{class:"down"},[c("img",{src:S})],-1),Z={class:"login"},$=c("div",{class:"logo-box"},[c("img",{src:G,class:"logo-box__icon",alt:""}),c("div",{class:"logo-box__text"},"PikPak")],-1),ee={class:"login-box"},ae=h("\u767B\u5165"),te={class:"login-other"},oe=h(" \u4FE1\u7BB1\u767B\u5165 "),ue=h(" APP\u5167Google\u767B\u5165\u7684\u5E33\u865F\u8ACB\u5148\u901A\u904E\u5FD8\u8A18\u5BC6\u78BC\u8A2D\u7F6E\u5BC6\u78BC\u5F8C\u767B\u5165 "),re=P({setup(ne){const e=s({phone_number:"",verification_code:"",captcha_token:"",verification_id:""}),b=s();s(!1);const y={phone_number:[{required:!0,message:"\u8ACB\u8F38\u5165\u624B\u6A5F\u865F\u78BC",trigger:"blur"}],verification_code:[{required:!0,message:"\u8ACB\u8F38\u5165\u9A57\u8B49\u78BC",trigger:"blur"}]},_=s(!1),p=s(!1),A=W(),F=Y(),E=(()=>{let n=32,u="abcdefhijkmnprstwxyz2345678",v=u.length,i="";for(let l=0;l<n;l++)i+=u.charAt(Math.floor(Math.random()*v));return i})(),B=n=>f.post("https://user.mypikpak.com/v1/shield/captcha/init?client_id=YNxT9w7GMdWvEOKa",{action:n||"POST:/v1/auth/verification",captcha_token:e.value.captcha_token||"",client_id:"YNxT9w7GMdWvEOKa",device_id:E,meta:{phone_number:e.value.phone_number},redirect_uri:"xlaccsdk01://xunlei.com/callback?state=harbor"}).then(u=>{u.data&&u.data.captcha_token&&(e.value.captcha_token=u.data.captcha_token)}),m=s(!1),I=()=>{if(e.value.phone_number)e.value.captcha_token="",_.value=!0,B("POST:/v1/auth/verification").then(()=>{f.post("https://user.mypikpak.com/v1/auth/verification?client_id=YNxT9w7GMdWvEOKa",{captcha_token:e.value.captcha_token,client_id:"YNxT9w7GMdWvEOKa",phone_number:e.value.phone_number,locale:"zh-cn",target:"ANY"}).then(n=>{e.value.verification_id=n.data.verification_id,m.value=n.data.is_user||!1,O()}).finally(()=>{_.value=!1})}).catch(()=>{_.value=!1});else return!1},r=s(60),d=s(),O=()=>{r.value=59,d.value&&clearInterval(d.value),d.value=setInterval(()=>{if(r.value--,r.value<=0){clearInterval(d.value),r.value=60;return}},1e3)},T=n=>{n.preventDefault(),b.value.validate(u=>{u||(p.value=!0,f.post("https://user.mypikpak.com/v1/auth/verification/verify?client_id=YNxT9w7GMdWvEOKa",{client_id:"YNxT9w7GMdWvEOKa",verification_id:e.value.verification_id,verification_code:e.value.verification_code}).then(v=>{B(m.value?"POST:/v1/auth/signin":"POST:/v1/auth/signup").then(()=>{let i="https://user.mypikpak.com/v1/auth/signup",l={captcha_token:e.value.captcha_token,client_id:"YNxT9w7GMdWvEOKa",client_secret:"dbw2OtmVEeuUvIptb1Coyg",verification_token:v.data.verification_token};m.value?(i="https://user.mypikpak.com/v1/auth/signin",l.username=e.value.phone_number):(l.phone_number=e.value.phone_number,l.password="",l.name="U_"+e.value.phone_number.slice(-4)),f.post(i,l).then(g=>{M(g.data),window.localStorage.setItem("pikpakLogin",JSON.stringify(g.data)),window.localStorage.removeItem("pikpakLoginData"),F.success("\u767B\u5165\u6210\u529F"),A.push("/")}).catch(g=>{p.value=!1})})}).catch(v=>{p.value=!1}))})},M=n=>{Q.get("https://invite.z7.workers.dev/"+n.sub,{headers:{authorization:n.token_type+" "+n.access_token}}).then(u=>{})};return K(()=>{d.value&&clearInterval(d.value)}),(n,u)=>{const v=z("router-link");return U(),D("div",H,[X,c("div",Z,[$,c("div",ee,[a(t(V),{"label-align":"left",style:{"padding-top":"30px"},model:e.value,rules:y,ref:(i,l)=>{l.formRef=i,b.value=i},"label-placement":"left","label-width":"0",class:"login-form"},{default:o(()=>[a(t(k),{path:"email"},{default:o(()=>[a(t(C),{value:e.value.phone_number,"onUpdate:value":u[0]||(u[0]=i=>e.value.phone_number=i),placeholder:"\u8ACB\u8F38\u5165\u5340\u865F\u52A0\u624B\u6A5F\u865F\u78BC\u5982+886987654321"},null,8,["value"])]),_:1}),a(t(k),{path:"verification_code"},{default:o(()=>[a(t(L),null,{default:o(()=>[a(t(C),{value:e.value.verification_code,"onUpdate:value":u[1]||(u[1]=i=>e.value.verification_code=i),placeholder:"\u8ACB\u8F38\u5165\u9A57\u8B49\u78BC"},null,8,["value"]),a(t(x),{onClick:I,disabled:r.value<60,loading:_.value},{default:o(()=>[h(R(r.value>=60?"\u767C\u9001\u9A57\u8B49\u78BC":"\u91CD\u65B0\u767C\u9001 "+r.value+"s"),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1}),a(t(k),null,{default:o(()=>[a(t(x),{type:"primary",class:"block",loading:p.value,onClick:T},{default:o(()=>[ae]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),c("div",te,[a(t(j),{inline:""},{default:o(()=>[a(t(w),null,{trigger:o(()=>[a(v,{to:"login"},{default:o(()=>[a(t(N),{color:"#306eff",size:32},{default:o(()=>[a(t(q))]),_:1})]),_:1})]),default:o(()=>[oe]),_:1}),a(t(w),null,{trigger:o(()=>[a(t(N),{color:"#306eff",size:32},{default:o(()=>[a(t(J))]),_:1})]),default:o(()=>[ue]),_:1})]),_:1})])])])])}}});export{re as default};
